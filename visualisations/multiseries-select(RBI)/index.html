<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link href="nv.d3.css" rel="stylesheet" type="text/css">
<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js'></script>
    <script src="nv.d3.js"></script>
    <script src="stream_layers.js"></script>

    <style>
        text {
            font: 12px sans-serif;
        }
        svg {
            display: block;
        }
        body{
            margin:0 auto;
        }
       #chart, svg {
          margin:0 auto;
            padding: 0px;
            height: 600px;
            width: 80%;
        }.nvd3 .nv-axis.nv-x path.domain {
  stroke-opacity: 1;
}

         svg, .nv-background rect{
            background-image: url("body-background.png");
        }
        .nvd3 .nv-axis line{
            stroke:rgba(0, 0, 0, 0.05);
        }

        .nv-point {
    stroke-opacity: 1!important;
    stroke-width: 1px!important;
    fill-opacity: 0!important;
    }
        .nv-point.hover{
            stroke-width: 9px!important;
    fill-opacity: .95 !important;
    stroke-opacity: .95 !important;
        }

    </style>
</head>
<body>
<div class="scheme-select"></div>
<div id="chart" class='with-3d-shadow with-transitions'>

    <svg></svg>
</div>

<script>
d3.csv("Table 1 - Gross Fiscal Deficit.csv", function(error,data){


    var parseDate = d3.time.format("%Y").parse;


    var chdata=[];
    for(var i=0;i<data.length;i++)

    {   
        key=Object.keys(data[i])
        key.shift();
        var state= new Object();
        state.key = data[i].States
        state.disabled = data[i].States=="All States"?false:true
        var values_arr=[]
        for(var j =0;j <key.length;j++)
        {
            if (data[i][key[j]]=="..."){
                continue;

            }
            else{
              
            var temp= new Object();
            temp.x=parseDate(key[j].substring(0,4));
            temp.y=parseFloat(data[i][key[j]])
            values_arr.push(temp);
            }
           
        }
        state.values=values_arr
     
        chdata.push(state);
   }


   var types= new Set()
   for( var i =0;i<chdata.length;i++){
    
        types.add(chdata[i].type);
   }
   selection=chdata[0].type;
   selected_data=[]
   function getdata(selection){
    selected_data=[]
    
    for(var j=0;j<chdata.length;j++)
    {
        if (chdata[j].type==selection){
           
            selected_data.push(chdata[j])
        }
        
    }
    
    return selected_data;
   }
   
   

var chart;
var chartData;
 
    
    nv.addGraph(function() {
        chart = nv.models.lineWithFocusChart();
        
         chart.showLegend(true)
         var xScale = d3.time.scale();
        var mini, max;
        var minmax;
        chart.xScale;

        chart.xAxis
     .tickFormat(function(d) { return d3.time.format('%Y')(new Date(d)) }).axisLabel("Year");
     chart.x2Axis.height("200px")
     .tickFormat(function(d) { return d3.time.format('%Y')(new Date(d)) });
        
        chart.yAxis.axisLabel("Gross Fiscal Deficit (Rs. Crore)")
        chart.focusHeight(100)
        chart.pointSize(10)
   
   
        chart.useInteractiveGuideline(true);
        chartdata=d3.select('#chart svg')
            .datum(chdata)
            .call(chart);

        console.log(chart.availableWidth )
        chartdata.transition().duration(500).call(chart);
        nv.utils.windowResize(chart.update);
        return chart;
    });

    
     
        

});

   
</script>
</body>
</html>